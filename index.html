<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>출석 프로그램</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input {
            margin-bottom: 10px;
            padding: 5px;
            width: 200px;
        }
        button {
            padding: 5px 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .admin-section {
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <h1>출석 프로그램</h1>
    <form id="attendance-form">
        <h2>출석</h2>
        <label for="student-id">학번:</label>
        <input type="text" id="student-id" required>
        <label for="student-name">이름:</label>
        <input type="text" id="student-name" required>
        <label for="student-code">코드:</label>
        <input type="text" id="student-code" required>
        <button type="submit">확인</button>
    </form>
    <h2>출석 리스트</h2>
    <table id="attendance-table">
        <thead>
            <tr>
                <th>이름</th>
                <th>학번</th>
            </tr>
        </thead>
        <tbody id="attendance-list">
            <!-- Firebase에서 가져온 데이터가 자동으로 추가될 예정 -->
        </tbody>
    </table>

    <div class="admin-section">
        <h2>관리자 기능</h2>
        <button onclick="adminAction(true)">출석 데이터 초기화</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>
    <script>
        // Firebase 구성 정보
        const firebaseConfig = {
            apiKey: "Your-API-Key",
            authDomain: "your-auth-domain.firebaseapp.com",
            databaseURL: "https://your-database-url.firebaseio.com",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id",
            measurementId: "your-measurement-id"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 출석 리스트 초기화
        function initAttendanceList() {
            const attendanceListRef = db.ref('0709'); // 데이터베이스에서 0709 레퍼런스 가져오기
            attendanceListRef.once('value', snapshot => {
                snapshot.forEach(childSnapshot => {
                    const student = childSnapshot.val();
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${student.name}</td>
                        <td>${student.id}</td>
                    `;
                    document.getElementById('attendance-list').appendChild(newRow);
                });
            });
        }

        // 출석 리스트 초기화 호출
        initAttendanceList();

        // 출석 제출 폼 처리
        document.getElementById('attendance-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const studentId = document.getElementById('student-id').value;
            const studentName = document.getElementById('student-name').value;
            const studentCode = document.getElementById('student-code').value;

            if (studentCode !== '156655') { // 코드 검증
                alert('올바른 코드를 입력하세요.');
                return;
            }

            // Firebase에서 학생 찾기
            const studentsRef = db.ref('0709');
            studentsRef.once('value', snapshot => {
                let found = false;
                snapshot.forEach(childSnapshot => {
                    const student = childSnapshot.val();
                    if (student.id === studentId && student.name === studentName) {
                        found = true;
                        // 데이터 삭제
                        childSnapshot.ref.remove()
                            .then(() => {
                                alert('학생 정보가 성공적으로 삭제되었습니다.');
                                location.reload(); // 페이지 새로고침
                            })
                            .catch(error => {
                                console.error('데이터 삭제 중 오류:', error);
                                alert('데이터 삭제 중 오류가 발생했습니다.');
                            });
                    }
                });
                if (!found) {
                    alert('학번과 이름이 일치하는 학생이 없습니다.');
                }
            });
        });

        // 관리자 기능 - 출석 데이터 초기화
        function adminAction(reset) {
            if (reset) {
                const confirmation = confirm('출석 데이터를 초기화하시겠습니까?');
                if (confirmation) {
                    const attendanceListRef = db.ref('0709');
                    attendanceListRef.remove()
                        .then(() => {
                            alert('출석 데이터가 성공적으로 초기화되었습니다.');
                            location.reload(); // 페이지 새로고침
                        })
                        .catch(error => {
                            console.error('출석 데이터 초기화 중 오류:', error);
                            alert('출석 데이터 초기화 중 오류가 발생했습니다.');
                        });
                }
            } else {
                alert('현재 상태가 유지됩니다!!');
            }
        }
    </script>
</body>
</html>
